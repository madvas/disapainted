"use strict";var AppConfig=function(){var a="disapainted",b=["ngAnimate","ngMessages","ui.router","ui.bootstrap","ui.utils","restangular","angular-lodash","ngStorage","ngMaterial","djds4rce.angular-socialshare","colorpicker.module","ngToast","yaru22.angular-timeago","angulartics","angulartics.google.analytics","angularFileUpload"],c=function(b,c){angular.module(b,c||[]),angular.module(a).requires.push(b)};return{appModuleName:a,appModuleVendorDependencies:b,registerModule:c}}();angular.module(AppConfig.appModuleName,AppConfig.appModuleVendorDependencies),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[AppConfig.appModuleName])}),AppConfig.registerModule("animations"),AppConfig.registerModule("canvas"),AppConfig.registerModule("core"),AppConfig.registerModule("users"),function(){function a(a,b,c,d){function e(){n.push(a.$watch("current.anim",function(a){o.isEmpty(a)||(p.anim.comments=h(0).$object)})),a.$on("$destroy",l)}function f(){p.anim.comments=h(0).$object}function g(){h(p.anim.comments.length).then(function(a){p.anim.comments=p.anim.comments.concat(a)})}function h(a){m.loading=!0;var b=p.anim.getList("comments",{sort:m.commentsStorage.sort,offset:a});return b.then(function(a){m.allLoaded=a.length<c.commentsPageSize,m.loading=!1}),b}function i(a){var b=m.message,c={message:b,dateCreation:Date.now(),creator:q.user._id,likes:[]};p.anim.comments.unshift(c),m.message="",a.commentForm.$setPristine(),p.anim.post("comments",{message:b}).then(function(a){c._id=a._id,d.eventTrack("comment-add",{category:q.user._id,label:a._id})},function(){p.anim.comments.shift(),m.message=b})}function j(a){var b=o.findIndex(p.anim.comments,{_id:a._id});p.anim.comments.splice(b,1),p.anim.one("comments",a._id).remove().then(function(){d.eventTrack("comment-delete",{category:q.user._id,label:a._id})},function(){p.anim.comments.splice(b,0,a)})}function k(a){var b="like",c=a.likes.indexOf(q.user._id);~c?(a.likes.splice(c,1),b="unlike"):a.likes.push(q.user._id),p.anim.one("comments",a._id).post(b,{}).then(function(){d.eventTrack("comment-"+b,{category:q.user._id,label:a._id})},function(){~c?a.likes.push(q.user._id):a.likes.pop()})}function l(){o.invoke(n,"call")}var m=this,n=[],o=a,p=a.current,q=a.auth;m.sortOptions=[{name:"Top comments",value:"-likesCount"},{name:"Newest first",value:"-dateCreation"}],m.commentsStorage=b.$default({comments:{sort:m.sortOptions[0].value}}).comments,m.activate=e,m.sortChange=f,m.getComments=h,m.addComment=i,m.deleteComment=j,m.likeComment=k,m.showMore=g,e()}angular.module("animations").controller("CommentsAnimationController",a),a.$inject=["$scope","$localStorage","AnimsConfig","$analytics"]}(),function(){function a(a){a.clear()}angular.module("animations").run(a),a.$inject=["dpResource"]}(),function(){function a(a,b,c,d){var e=c,f=a,g=d.getType(),h=new e.Rectangle(0,0,b.canvas.width,b.canvas.height);a.$on("$stateChangeSuccess",function(){e.projects[0]&&e.projects[0].remove(),e.tools[0]&&e.tools[0].remove()}),e.Group.inject({dpGetBackground:function(a){var b,c=this.getItem({name:"background"});return c||(b=f.clone(a||h),c=new e.Path.Rectangle(b),c.name="background",c.strokeWidth=0,this.addChild(c)),c}}),e.Layer.inject({dpGetDataURL:function(a){var b,c,d=f.clone(a||h);return e.view&&(d.width*=e.view.pixelRatio,d.height*=e.view.pixelRatio),this.strokeBounds.x<0&&(d.x-=this.strokeBounds.x*e.view.pixelRatio),this.strokeBounds.y<0&&(d.y-=this.strokeBounds.y*e.view.pixelRatio),a&&"safari"!==g&&(d.x+=1,d.y+=1),b=this.rasterize().getSubRaster(d),c=b.toDataURL(),b.remove(),c}})}angular.module("animations").run(a),a.$inject=["$rootScope","AnimsConfig","dpPaperScope","dpBrowserType"]}(),function(){function a(a){a.state("animations",{"abstract":!0,url:"/animations",controller:"ViewAnimationController",controllerAs:"vm",templateUrl:"modules/animations/view/view-anim.client.view.html"}).state("animations.list",{"abstract":!0,views:{list:{controller:"ListAnimationsController",controllerAs:"vm",templateUrl:"modules/animations/list/list-anims.client.view.html"},"":{template:"<div data-ui-view></div>"}}}).state("animations.list.content",{url:"/:animId",controller:"ContentAnimationController",controllerAs:"vm",templateUrl:"modules/animations/view/content-anim.client.view.html"})}angular.module("animations").config(a),a.$inject=["$stateProvider"]}(),function(){function a(){function a(a,d,e){e.$observe("dpAnimHref",function(a){var d="true"===e.dpCanvasHref?b:c;a&&e.$set("href",d+e.dpAnimHref)})}var b="canvas/",c="animations/",d={link:a,restrict:"A"};return d}angular.module("animations").directive("dpAnimHref",a),a.$inject=[]}(),function(){function a(a,b,c){function d(a,c){angular.element(b).bind("resize",g.partial(e,c)),e(c),c.find("md-progress-circular").removeClass(i.join(" ")).addClass(i[g.random(i.length-1)])}function e(b){var c=b.prop("clientWidth")||a.canvas.width;b.css("height",c*h+"px")}var f,g=c,h=a.canvas.height/a.canvas.width,i=["md-primary","md-accent","md-warn"];return f={link:d,restrict:"A",transclude:!0,template:'<div layout="column" layout-align="center center" class="anim-loading-wrap"><md-progress-circular md-mode="indeterminate"></md-progress-circular><span class="font-sm mar-top-10" data-ng-transclude></span></div>'}}angular.module("animations").directive("dpAnimLoader",a),a.$inject=["AnimsConfig","$window","$rootScope"]}(),function(){function a(a){var b=a,c="dist/thumbnails/anims/anims_tpl.png";return function(a){return b.isEmpty(a)||b.isEmpty(a.rasterized)?c:"data"===a.rasterized.substring(0,4)?a.rasterized:"data:image/png;base64,"+a.rasterized}}angular.module("animations").filter("dpRasterize",a),a.$inject=["$rootScope"]}(),function(){function a(a,b,c,d,e,f,g,h,i){function j(){q.push(a.$watch("current.creator",function(a){r.isEmpty(a)||(p.sortOptions[6].value="user/"+a._id,p.sortOptions[6].name="More from "+a._id,~p.listStorage.sort.indexOf("user")&&(p.listStorage.sort=p.sortOptions[6].value,k()))})),a.$on("$destroy",m),~p.listStorage.sort.indexOf("user")?p.listStorage.sort="user/":k()}function k(){p.loading=!0,p.anims=[],d.all("list/anims/"+p.listStorage.sort).getList({page:p.listStorage.page,limit:c.listPageSize}).then(function(a){p.loading=!1,p.anims=a,e.set(a),p.pageCount=a.meta.pageCount,p.totalCount=a.meta.totalCount,h.eventTrack("listAnims",{category:p.listStorage.sort,label:p.listStorage.page})})}function l(){!p.listStorage.page||p.listStorage.page<1||p.listStorage.page>p.pageCount||(g.hash("top-list"),f(),k())}function m(){r.invoke(q,"call")}function n(){return r.contains(i.user.roles,"admin")}function o(a){d.restangularizeElement(null,a,"anims").remove().then(function(){r.remove(p.anims,a)})}var p=this,q=[],r=a;p.sortOptions=[{name:"Most Awesome Animations",value:"likes/0"},{name:"Awesome Animations last day",value:"likes/1"},{name:"Awesome Animations last week",value:"likes/7"},{name:"Awesome Animations last month",value:"likes/30"},{name:"Recent Animations",value:"recent"},{name:"Random Animations",value:"random"},{name:"More from ...",value:"user/"}],p.totalItems=0,p.listPageSize=c.listPageSize,p.listStorage=b.$default({list:{sort:p.sortOptions[0].value,page:1}}).list,p.activate=j,p.getList=k,p.changeList=l,p.isAdminLogged=n,p.removeAnim=o,j()}angular.module("animations").controller("ListAnimationsController",a),a.$inject=["$scope","$localStorage","AnimsConfig","Restangular","dpResource","$anchorScroll","$location","$analytics","Authentication"]}(),function(){function a(a,b,c,d,e){function f(a,b){var f=[],m=d.defer(),o=[];return n.animId===e.animId&&n.gif?(m.resolve(n.gif),m.promise):(g.progressValue=0,n={animId:e.animId,gif:!1},i.each(a,function(a){var b=d.defer(),c=new Image;c.src=a.rasterized,c.addEventListener("load",function(a){b.resolve(a.target)}),o.push(b.promise),b.promise.then(function(b){h.clearRect(0,0,k,j),h.fillRect(0,0,k,j),h.drawImage(b,0,0),f.push({order:a.order,data:h.getImageData(0,0,k,j).data})})}),l.addEventListener("message",function(a){switch(a.data.type){case"progress":g.progressValue=a.data.value;break;case"result":var b=c.btoa(a.data.value),d="data:image/gif;base64,"+b;b.length<=5?m.reject("Generated gif was too short"):(m.resolve(d),n.gif=d)}},!1),l.addEventListener("error",function(a){m.reject(a.message)},!1),d.all(o).then(function(){f=i.pluck(i.sortBy(f,"order"),"data"),l.postMessage([f,b,k,j])}),m.promise)}var g,h,i=a,j=b.canvas.height,k=b.canvas.width,l=new Worker("modules/animations/workers/dpGifEncoder.client.worker.js"),m=angular.element("<canvas/>"),n={};return m.css("display","none"),m[0].width=k,m[0].height=j,h=m[0].getContext("2d"),h.fillStyle="rgb(255,255,255)",g={encode:f,progressValue:0}}angular.module("animations").factory("dpGifEncoder",a),a.$inject=["$rootScope","AnimsConfig","$window","$q","$stateParams"]}(),function(){function a(a,b,c){function d(a){k.each(a,function(a){a.objectData&&(a.objectData=e(a.objectData))})}function e(a){return c.unpack(a)}function f(a){return a=h(a),c.pack(c.JSON.stringify(a))}function g(a){var b=new l.Project,c=b.activeLayer;k.each(a,function(a){c.importJSON(a.objectData),c.dpGetBackground().opacity=1,a.rasterized=c.dpGetDataURL(),c.removeChildren()}),b.remove()}function h(a){return i(a,function(a){a.data&&(delete a.data.handleId,delete a.data.scale,delete a.data.stkId)}),a}function i(a,b){function c(a){k.isArray(a)?c(a[1]):a.children&&k.each(a.children,function(a){b(a[1]),c(a[1])})}c(a)}var j,k=a,l=b;return j={unpackFrames:d,pack:f,unpack:e,rasterize:g}}angular.module("animations").factory("dpObjectData",a),a.$inject=["$rootScope","dpPaperScope","jsonpack"]}(),function(){function a(a){var b={},c=new a.PaperScope;return c.install(b),b.paperScope=c,b}angular.module("animations").factory("dpPaperScope",a),a.$inject=["paper"]}(),function(){function a(a,b,c){function d(){l.currentFrame=0,l.frames={}}function e(a){if(a=l.settings.backwards?-a:a,0>a)if(l.currentFrame>0)l.currentFrame+=a;else{if(!l.settings.repeat)return void h();l.currentFrame=l.lastFrame()}else if(l.currentFrame<l.lastFrame())l.currentFrame+=a;else{if(!l.settings.repeat)return void h();l.currentFrame=0}f()}function f(a){if(l.playing){var b=a?0:j(),d=l.frames[l.currentFrame];d?c(m.partial(l.next,1),b*l.frames[l.currentFrame].repeat):h()}}function g(){l.playing||(l.currentFrame!==l.lastFrame()||l.settings.backwards?0===l.currentFrame&&l.settings.backwards&&(l.currentFrame=l.lastFrame()):l.currentFrame=0),l.playing=!l.playing,f(!0)}function h(){l.playing=!1}function i(){return m.keys(l.frames).length-1}function j(){return 50*(11-l.settings.speed)-15*(11-l.settings.speed)}function k(){return m.map(l.frames,function(a){return j()*a.repeat})}var l,m=a,n=b.$default({player:{speed:5,repeat:!1,backwards:!1}}).player;return l={currentFrame:0,frames:{},settings:n,init:d,next:e,play:g,stop:h,lastFrame:i,getDelays:k}}angular.module("animations").factory("dpPlayer",a),a.$inject=["$rootScope","$localStorage","$timeout"]}(),function(){function a(a,b,c,d,e,f,g,h){function i(){h(function(){d.users={}},9e5)}function j(a,c){c=c||"anims";var f=d[c][a];if("anims"===c&&f){var g=e.defer();return f=b.restangularizeElement(null,f,c),g.resolve(f),p.extend(g.promise,{$object:f})}return f=b.one(c,a).get(),d[c][a]=f.$object,f}function k(a,b){a=p.isArray(a)?a:[a],p.merge(d[b||"anims"],p.indexBy(a,"_id"))}function l(a,b){d[b||"anims"]=p.indexBy(a,"_id")}function m(a,b){var d,h={},i=[],j=f.framesPageSize,k=b?"edit/frames":"frames";return c.frames=c.frames||{},p.times(Math.ceil(a.framesCount/j),function(b){var c=a.getList(k,{offset:b*j});c.then(function(a){return p.extend(h,p.indexBy(a,"order")),g.unpackFrames(a,h)}),i.push(c)}),d=e.all(i),d.then(function(){p.each(h,function(a,b){return a.objectData||(h[b].objectData=h[a.order-1].objectData),a}),g.rasterize(h)}),d.$object=h,d}function n(){d.anims={},d.users={}}var o,p=a;return d.anims=d.anims||{},d.users=d.users||{},o={get:j,set:l,add:k,getFrames:m,clear:n},i(),o}angular.module("animations").factory("dpResource",a),a.$inject=["$rootScope","Restangular","$localStorage","$sessionStorage","$q","AnimsConfig","dpObjectData","$interval"]}(),function(){function a(a,b,c,d,e,f,g,h,i,j){function k(){b.hash("top"),f(),p.player.init(),p.loading=!0,c.get(e.animId).then(function(a){var b=c.getFrames(a);p.current.anim=a,p.player.frames=b.$object,b.then(function(){p.loading=!1}),c.get(a.creator,"users").then(function(a){p.current.creator=a})})}function l(){return p.current.anim?"Animation: "+p.current.anim.title:void 0}function m(){var a=1,b="like";return p.auth.user?(p.current.anim.liked&&(a=-a,b="unlike"),p.current.anim.likesCount+=a,p.current.creator.likesCount+=a,p.current.anim.liked=!!~a,void p.current.anim.post(b,{}).then(function(){h.eventTrack("anim-"+b,{category:p.auth.user._id,label:p.current.anim._id})},function(){p.current.anim.likesCount+=-a,p.current.creator.likesCount+=-a,p.current.anim.liked=!p.current.anim.liked})):void d.go("userForm.signin")}function n(a){i.show({controller:"GifAnimController",controllerAs:"vm",templateUrl:"modules/animations/view/dialogs/gif-anim.client.view.html",targetEvent:a,hasBackdrop:!1})}function o(){return!!j.Worker}var p=this;p.current=a.current,p.auth=a.auth,p.player=g,p.absUrl=b.absUrl().split("#")[0],p.activate=k,p.getShareText=l,p.likeAnim=m,p.gifDialog=n,p.isWorkerSupported=o,k()}angular.module("animations").controller("ContentAnimationController",a),a.$inject=["$scope","$location","dpResource","$state","$stateParams","$anchorScroll","dpPlayer","$analytics","$mdDialog","$window"]}(),function(){function a(a,b,c,d,e,f,g){function h(){j.loading=!0,c.encode(b.frames,b.getDelays()).then(function(a){j.gif=a,j.loading=!1,e.eventTrack("gif-success",{category:l,label:k})},function(a){d.danger("Sorry, I was unable to generate gif from this animation"),e.eventTrack("gif-err",{category:k,label:a}),i()})}function i(){a.hide()}var j=this,k=g.animId,l=f.user._id;j.answer=i,j.dpGifEncoder=c,j.framesCount=b.lastFrame()+1,h()}angular.module("canvas").controller("GifAnimController",a),a.$inject=["$mdDialog","dpPlayer","dpGifEncoder","dpToast","$analytics","Authentication","$stateParams"]}(),function(){function a(a,b){a.auth=b,a.current={}}angular.module("animations").controller("ViewAnimationController",a),a.$inject=["$scope","Authentication"]}(),function(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){var b;a.$on("actionsReady",function(){t.selectedAction=t.dpObjects.actions[0]}),t.f.init(),c.get(d.animId).then(function(d){t.auth.user&&t.auth.user._id===d.creator||e.go("userForm.signin"),t.current.anim=d,b=c.getFrames(t.current.anim,!0),t.f.frames=b.$object,b.then(function(b){b=u.sortBy(u.flatten(b),"order"),b.length?(t.c.initLayers(b),t.f.currentFrameIndex=0,t.f.currentFrame=b[0],l.eventTrack("anim-edit",{category:t.auth.user._id,label:t.current.anim._id})):t.f.newFrame(),t.loading=!1,a.$watch("vm.f.currentFrame",function(a){t.c.activateLayer(a)})})})}function o(){return t.f.framesCount>=10}function p(a){u.each(a,function(a){if("stk"!==a.name.split(".").pop())return void m.danger(a.name+" doesn't seem like .stk file. Stk files are created in Pivot Animator software");var b=new FileReader;b.onload=function(a){t.selectedAction.execute({source:a.target.result})},b.readAsArrayBuffer(a)})}function q(a){u.each(a,function(a){if("image/svg+xml"===a.type){if(a.size>5e4)return void m.danger("Sorry, imported SVG file is too big!");var b=new FileReader;b.onload=function(a){t.selectedAction.execute({source:a.target.result})},b.readAsText(a)}})}function r(a){t.t.detachKeyEvents(),t.f.save().then(function(){k.show({controller:"CanvasPublishAnimController",controllerAs:"vm",templateUrl:"modules/canvas/canvas/dialogs/publish-canvas.client.view.html",targetEvent:a,hasBackdrop:!1}).then(function(a){a&&t.current.anim.post("publish",a).then(function(){c.clear(),e.go("animations.list.content",{animId:t.current.anim._id}),l.eventTrack("anim-publish",{category:t.auth.user._id,label:t.current.anim._id})})})["finally"](function(){t.t.attachKeyEvents()})})}function s(a,b){t.t.detachKeyEvents(),k.show({controller:"Canvas"+a+"Controller",controllerAs:"vm",templateUrl:"modules/canvas/canvas/dialogs/"+a.toLowerCase()+"-canvas.client.view.html",targetEvent:b,hasBackdrop:!1}).then(function(a){u.isEmpty(a)||t.selectedAction.execute({source:a})})["finally"](function(){t.t.attachKeyEvents()})}var t=this,u=a;t.current={},t.loading=!0,t.auth=b,t.dpConfig=i,t.dpObjects=g,t.newObjectType="Stickman",t.c=f,t.t=h,t.f=j,t.activate=n,t.isPublishable=o,t.publishAnimDialog=r,t.openActionDialog=s,t.importSVG=q,t.importSTK=p,t.selectedAction=t.dpObjects.actions[0],n()}angular.module("canvas").controller("CanvasController",a),a.$inject=["$scope","Authentication","dpResource","$stateParams","$state","dpCanvas","dpCanvasObjects","dpCanvasTool","dpCanvasConfig","dpCanvasFrames","$mdDialog","$analytics","dpToast"]}(),function(){function a(a,b,c){function d(a){return!!~a.indexOf(".svg")}function e(a,b){b&&(a=g.clone(a.target.nearestViewportElement||a.target)),c.hide(a)}var f=this,g=a;f.pictures=b.canvas.pictures,f.answer=e,f.isSvg=d,f.pageSize=20}angular.module("canvas").controller("CanvasPictureController",a),a.$inject=["$rootScope","AnimsConfig","$mdDialog"]}(),function(){function a(a,b){function c(a){b.hide(a)}var d=this;d.answer=c,d.AnimsConfig=a}angular.module("canvas").controller("CanvasPublishAnimController",a),a.$inject=["AnimsConfig","$mdDialog"]}(),function(){function a(a,b,c){function d(a){g.selected[a]?delete g.selected[a]:g.selected[a]=!0}function e(){return h.keys(g.selected).length}function f(a){c.hide(h.keys(a))}var g=this,h=a;g.figures=b.canvas.figures,g.figuresPath=b.canvas.figuresPath,g.selected={},g.answer=f,g.pageSize=24,g.toggleSelect=d,g.selectedCount=e}angular.module("canvas").controller("CanvasStickfigureController",a),a.$inject=["$rootScope","AnimsConfig","$mdDialog"]}(),function(){function a(a){function b(b){a.hide(b)}var c=this;c.answer=b}angular.module("canvas").controller("CanvasTextController",a),a.$inject=["$mdDialog"]}(),function(){function a(a){a.state("canvas",{url:"/canvas/:animId",controller:"CanvasController",controllerAs:"vm",templateUrl:"modules/canvas/canvas/canvas.client.view.html"})}angular.module("canvas").config(a),a.$inject=["$stateProvider"]}(),function(){function a(a,b,c,d,e){function f(d,e){h.paperScope.setup(e[0]),c.init(),a.init(h.projects[0]),b.init(),d.$on("$destroy",g)}function g(){a.destroy(),b.destroy(),e.destroy()}var h=d,i={link:f,restrict:"A"};return i}angular.module("canvas").directive("dpCanvas",a),a.$inject=["dpCanvas","dpCanvasTool","dpCanvasPaper","dpPaperScope","dpCanvasFrames"]}(),function(){function a(){function a(a,b,c){var d,e,f=b.prop("offsetWidth")-30;c.$observe("dpCurrentFrameIndex",function(a){e=c.dpFramesCount,d||(d=b.find("li").eq(0).prop("offsetWidth")+10),b.scrollLeft(a/(e-1)*(e*d-f))})}var b={link:a,restrict:"A"};return b}angular.module("canvas").directive("dpCanvasThumbnails",a),a.$inject=[]}(),function(){function a(a,b,c,d){function e(b){la.push(a.$watch(function(){return fa.onionLayers.enabled},function(a,b){fa.background&&a!==b&&(fa.background.opacity=a?.1:1,j())})),la.push(a.$watch(function(){return fa.showHandles},function(a,b){a!==b&&R()})),la.push(a.$watch(function(){return fa.showAllPaths},function(a,b){a!==b&&S()})),ja=b,ja.activate()}function f(a){var b,c,d,e,f;a=ma.isArray(a)?a:[a],ja.activate(),ma.each(a,function(a){f=a.layer||new pa.Layer,ja.activeLayer.selected=!1,a.objectData&&f.importJSON(a.objectData),f.data={order:a.order},b=new pa.Group,b.name="handlesRoot",d=f.dpGetExportableGroup(),c=d.dpGetBackground(),e=d.dpGetObjectsRoot(),b.bringToFront(),c.sendToBack(),U(e.children,b),V(e.dpGetObjects()),f.addChild(b),c.opacity=1,a.layer=f})}function g(a){var b,c,d,e;a.layer&&a.layer.children.length||f(a),b=a.layer,b.activate(),b.visible=!0,b.opacity=1,fa.exportable=b.dpGetExportableGroup(),fa.objects=fa.exportable.dpGetObjectsRoot(),fa.background=fa.exportable.dpGetBackground(),fa.background.opacity=fa.onionLayers.enabled?.1:1,fa.handles=b.dpGetHandlesRoot(),fa.handles.visible=fa.showHandles,fa.objects.children.length&&(c=b.dpGetReferenceObjects(fa.selected.objects),qa.prevFrame&&c.length?(fa.selected.objects=c,n(c[0]),fa.selected.path&&(d=c[0].dpGetReferencePath(fa.selected.path),e=u(d),e.emit("mousedown",{target:e}))):(n(fa.objects.firstChild),m(fa.objects.firstChild.firstChild))),j()}function h(a){pa.view.draw(),i(a)}function i(b){var c=ja.activeLayer,d=c.clone(),e=qa.currentFrame;d.dpGetHandlesRoot().visible=!1,d.dpGetBackground().opacity=1,e.rasterized=d.dpGetDataURL(),e.objectData=c.dpGetExportableGroup().exportJSON({precision:1,asString:!1}),e.dirty=b?e.dirty:!0,d.remove(),a.$$phase||a.$apply()}function j(){var a,b;if(k(),ja.activeLayer.visible=!0,fa.objects.selected=fa.showAllPaths,fa.selected.path&&!fa.selected.path.data.movableRoot&&fa.showHandles&&(fa.selected.path.selected=!0),!fa.onionLayers.enabled)return void h(!0);b=ja.activeLayer.data.order,a=ma.filter(ja.layers,function(a){return a.data.order<b}),a=ma.sortBy(a,function(a){return a.data.order}),a=ma.last(a,fa.onionLayers.count);for(var c=0;c<a.length;c++)a[c].dpGetHandlesRoot().visible=!1,a[c].visible=!0,a[c].opacity=(c+.8)/10,a[c].dpGetBackground().opacity=0;h(!0)}function k(){for(var a=ja.layers,b=a.length,c=0;b>c;c++)a[c].visible=a[c].selected=!1}function l(a){var b;a=ma.isArray(a)?a:[a],ma.each(a,function(a){ma.each(a.dpGetMovablePaths(),function(a){b=u(a),b.position=a.dpGetOppositeSegment().point})})}function m(b){b&&(fa.selected.path=b,a.$$phase||a.$apply(),fa.showAllPaths||(fa.objects.selected=!1,fa.selected.path.selected=!b.data.movableRoot),ia=ma.clone(b.data.scale))}function n(b){var c=ma.findIndex(fa.selected.objects,{id:b.id});~c?fa.selected.objects[0]=fa.selected.objects.splice(c,1,fa.selected.objects[0])[0]:fa.selected.objects=[b],a.$$phase||a.$apply(),ha=ma.clone(b.data.scale),p()}function o(){var a=ma.map(fa.selected.objects,function(a){return a.dpGetRootObjectOfJoinedGroup()});return ma.uniq(a,"id")}function p(a){r(oa.BLUR,a),q(fa.selected.objects,oa.SELECTED,a)}function q(a,b,c){a=ma.isArray(a)?a:[a];for(var d=0;d<a.length;d++)ma.invoke(w(a[d]),"dpSetState",b,!a[d].parent.dpIsObjectsRoot(),c)}function r(a,b){q(fa.objects.dpGetObjects(),a,b)}function s(){var a;fa.mode=na.JOIN,fa.selected.objects[0].parent.dpIsObjectsRoot()?(a=fa.selected.objects[0].dpGetObjects(),r(oa.JOIN),q(a,oa.HIDE)):(t(fa.selected.objects[0]),fa.mode=na.SELECT),h()}function t(a){var b;a=ma.isArray(a)?a:[a],ma.each(a,function(a){a.parent.dpIsObjectsRoot()||(b=u(a.parent.firstChild),fa.objects.addChild(a),b.data.joins--,b.sendToBack(),p())})}function u(a){return fa.handles.getItem({id:a.data.handleId})}function v(a){return fa.objects.getItem({data:{handleId:a.id}})}function w(a){return fa.handles.getItems({data:{objectId:a.id}})}function x(){return!(fa.selected.objects[0]&&fa.selected.objects[0].parent.dpIsObjectsRoot())}function y(a){fa.objects.exportSVG({precision:3,asString:!0});fa.selected.path.parent.dpChangeOrder(a),ma.invoke(ma.rest(fa.selected.objects),"dpChangeOrder",a),h()}function z(){ga=fa.selected.objects.length>1?o():[fa.selected.objects[0]],ma.each(ga,function(a){a.scale(-1,1,a.firstChild.firstSegment.point),l(a)}),h()}function A(){B(function(a){a.position=pa.view.center}),h()}function B(a){var b,c,d=o();c=ma.pluck(d,"index"),b=new pa.Group(d),fa.objects.parent.addChild(b),a(b),ma.each(ma.clone(b.children),function(a,b){fa.objects.insertChild(c[b],a)}),b.remove(),l(d)}function C(){ma.each(o(),function(a){ma.each(a.dpGetObjects(),function(a){ma.invoke(w(a),"remove")}),ma.invoke(w(a),"remove"),a.remove()}),fa.selected.objects=[],fa.selected.path=!1,h()}function D(){var a;ma.each(o(),function(b){a=b.clone(),fa.objects.addChild(a),a.translate([10,10]),a.dpUpdateReferences(),U(a)}),p(),h()}function E(){var a;ma.each(o(),function(b){ma.each(ma.rest(b.dpGetObjects()),function(c){a=u(c.firstChild),a.remove(),c.firstChild.remove(),ma.each(w(c),function(a){a.data.objectId=b.id}),ma.remove(fa.selected.objects,{id:c.id}),c.dpReduce()}),ma.each(w(b),function(a){a.data.joins=0})}),p(),h()}function F(){var a,b=o();b.length&&(fa.clipboard=ma.map(b,function(b){return a=b.exportJSON({asString:!1}),b.bounds.selected=!0,h(),a}),ma.delay(function(){ma.each(b,function(a){a.bounds.selected=!1,a.selected=fa.showAllPaths}),h()},100))}function G(){fa.clipboard.length&&(ma.each(fa.clipboard,function(a){H(a)}),p(),h())}function H(a,b){var c;return ja.activeLayer.importJSON(a),c=ja.activeLayer.lastChild,fa.objects.addChild(c),b&&(c.position=pa.view.center),U(c),c}function I(a,b){if(a=parseInt(a)){var c=Q(a,ha[b]);ma.each(o(),function(d){d.dpScale(c,b,fa.objectScaleLock),l(d),fa.objectScaleLock&&(d.data.scale={x:a,y:a})}),h(),ha=ma.clone(fa.selected.objects[0].data.scale)}}function J(a){0>a||(ma.each(o(),function(b){b.strokeWidth=a}),h())}function K(a,b,c){var d="path"===c?[fa.selected.path]:o();ma.invoke(d,"set"+a+"Color",b),h()}function L(a,b){if(a=parseInt(a)){var c,d=fa.selected.path,e=Q(a,ia[b]),f=d.dpGetOppositeSegment().point.clone();d.dpScale(e,b,fa.pathScaleLock,d.firstSegment.point),c=d.dpGetOppositeSegment().point.subtract(f),ma.invoke(d.dpGetGroupSiblings(),"translate",c),l(d.parent.parent),fa.pathScaleLock&&(d.data.scale={x:a,y:a}),h(),ia=ma.clone(d.data.scale)}}function M(){var a,b=fa.selected.objects[0].firstChild.data.handleRadius;ma.each(fa.selected.objects,function(c){ma.each(c.dpGetMovablePaths(),function(c){a=u(c),c.data.handleRadius=a.data.radius=b,a.dpSetRadius(b)})}),h()}function N(){var a=fa.selected.path,b=u(a);b.data.radius=a.data.handleRadius,b.dpSetRadius(a.data.handleRadius),h()}function O(a){var b;return fa.selected.objects.length&&fa.selected.path&&fa.selected.objects[0]&&fa.selected.path.data.movableRoot?(b=fa.selected.objects[0].dpGetTextItem(),ma.contains(["fontFamily","fontWeight"],a)&&b):!1}function P(a){var b=fa.selected.path;return b?b.data.movableRoot&&"handleRadius"!==a?!1:"handleRadius"!==a&&(b.dpIs("Raster")||b.dpIs("PointText"))?!1:!("strokeCap"===a&&b.dpIsCircle()):!1}function Q(a,b){return 1+(a-b)/50}function R(){fa.handles&&(fa.handles.visible=fa.showHandles,fa.selected.path&&!fa.showAllPaths&&(fa.selected.path.selected=fa.showHandles),h(!0))}function S(){fa.objects&&(fa.objects.selected=fa.showAllPaths,m(fa.selected.path),h(!0))}function T(){fa.onionLayers.enabled=!1,fa.background.opacity=1,h()}function U(a,c){c=c||fa.handles,a=ma.isArray(a)?a:[a],ma.each(a,function(a){ma.each(a.dpGetMovablePaths(),function(a){a.data.handleRadius=ma.isNumber(a.data.handleRadius)?a.data.handleRadius:b.handleRadius;var d=new pa.Path.Circle({data:{mainHandle:a.data.movableRoot,objectId:a.dpGetObject().id,joins:a.dpGetJoinedSiblings().length,radius:a.data.handleRadius},center:a.dpGetOppositeSegment().point,radius:1,strokeWidth:0});d.dpSetRadius(a.data.handleRadius),a.data.handleId=d.id,X(d),c.addChild(d)})})}function V(a){a=ma.isArray(a)?a:[a],ma.each(a,function(a){a.dpSetScaleParams(),ma.each(a.dpGetMovablePaths(),function(a){a.dpSetScaleParams()})})}function W(){fa.handles.removeChildren(),fa.objects.removeChildren(),fa.selected.objects=[],fa.selected.path=!1,h()}function X(a){a.onMouseDrag=a.data.mainHandle?_:aa,a.onMouseDown=$,a.onMouseUp=ba,a.onDoubleClick=ca}function Y(){var a=fa.onionLayers.enabled;return qa.playing?void qa.stop():(fa.showHandles=!1,fa.showAllPaths=!1,fa.onionLayers.enabled=!1,void qa.play().then(function(){fa.showHandles=!0,fa.onionLayers.enabled=a}))}function Z(){ma.invoke(la,"call"),la=[],ja.remove()}function $(a){var b=a.target,c=v(b),d=c.dpGetObject();return ga=[],m(c),fa.selected.handle=b,fa.mode===na.JOIN?(ga=[fa.selected.objects[0]],_({point:b.position}),c.parent.insertChild(1,fa.selected.objects[0]),b.data.joins=b.data.joins?b.data.joins++:1,ga=c.parent,b.bringToFront(),fa.mode=na.SELECT,void n(d)):(n(d),void(ga=b.data.mainHandle?o():fa.selected.path.parent))}function _(a){for(var b=a.point.subtract(fa.selected.objects[0].firstChild.firstSegment.point),c=0;c<ga.length;c++)ga[c].translate(b),l(ga[c])}function aa(a){var b,c,d,e,f,g=fa.selected.path;return b=g.firstSegment.point,c=g.dpGetOppositeSegment().point,d=c.subtract(b),e=a.point.subtract(b),f=d.getDirectedAngle(e),a.event.shiftKey&&!g.dpIsCircle()?void(g.firstSegment.handleOut=e):a.event.altKey?void ea(a,c,f):(ga.rotate(f,b),a.event.ctrlKey&&da(a,g,b,c),void l(ga))}function ba(){ka=!1}function ca(a){var b=v(a.target).dpGetObject();fa.selected.objects=[],n(b)}function da(a,b,c,d){var e,f,g;b.dpIsCircle()?(e=a.point.subtract(c).length/2,b.dpSetRadius(e,c),f=d.clone(),g=b.dpGetOppositeSegment().point.subtract(f)):(g=a.point.subtract(d),b.dpGetOppositeSegment().point=a.point),ma.invoke(fa.selected.path.dpGetGroupSiblings(),"translate",g)}function ea(a,b,c){var d,e,f,g;B(function(h){d=1===fa.selected.objects.length?fa.selected.objects[0].firstChild.firstSegment.point:ka?ka:ka=h.position,e=b.subtract(d).length,f=a.point.subtract(d).length,g=f/e,h.rotate(c,d),h.dpScale(g,"x",!0,d)})}var fa,ga,ha,ia,ja,ka,la=[],ma=a,na=b.mode,oa=b.handleState,pa=c,qa=d;return fa={selected:{objects:[]},mode:na.SELECT,objectScaleLock:!0,pathScaleLock:!0,showAllPaths:!1,showHandles:!0,clipboard:[],onionLayers:{enabled:!0,count:4},init:e,initLayers:f,initPlaying:Y,activateLayer:g,draw:h,applyActiveLayer:i,showOnionLayers:j,selectPath:m,selectObject:n,refreshHandles:p,setHandlesState:q,joinMode:s,getPathByHandle:v,isSelectedObjectJoined:x,changeSelectedOrder:y,flipSelected:z,centerSelected:A,removeSelected:C,cloneSelected:D,uniteSelected:E,copySelected:F,pasteSelected:G,importObject:H,setSelectedScale:I,setSelectedStrokeWidth:J,setSelectedColor:K,setSelectedPathScale:L,objectHandleRadiusChange:M,pathHandleRadiusChange:N,isObjectSettingVisible:O,isPathSettingVisible:P,backgroundChange:T,createHandles:U,createScales:V,clearCanvas:W,destroy:Z}}angular.module("canvas").factory("dpCanvas",a),a.$inject=["$rootScope","dpCanvasConfig","dpPaperScope","dpCanvasFrames"]}(),function(){function a(){return{mode:{SELECT:1,JOIN:2},handleState:{SELECTED:1,BLUR:2,JOIN:3,HIDE:4},handleColor:{1:["#FFC107","#E91E63"],2:["#00E676","#4CAF50"],3:["#82B1FF","#2196F3"]},handleRadius:7,fonts:["Arial","Verdana","Times New Roman","Courier New","serif","sans-serif","monospace"],fontWeights:["normal","bold","lighter"]}}angular.module("canvas").factory("dpCanvasConfig",a),a.$inject=[]}(),function(){function a(a,b,c,d,e,f,g,h,i,j){function k(){y.frames={},y.currentFrame={},y.clipboardFrame=!1,y.framesCount=0,y.playing=!1,A=0,z=g(y.save,3e5),C.push(b.$watch(function(){return D.keys(y.frames).length},function(a){y.framesCount=a})),C.push(b.$watch(function(){return y.currentFrameIndex},function(a,b){y.currentFrame=y.frames[a],y.prevFrame=y.frames[b]})),C.push(b.$on("$stateChangeStart",function(a,b,c,d){"canvas"===d.name&&(y.isClean()||(a.preventDefault(),y.save().then(D.partial(h.go,b,c))))}))}function l(){var b,g,h,j=[],k=A,l=d.get(a.animId).$object;return y.isClean()?(g=f.defer(),g.resolve(),g.promise):(b=D.map(y.getDirty(),function(a){var b=D.omit(a,"layer","dirty","rasterized");return 0===a.order&&(b.thumbnail=a.rasterized),b.objectData=i.pack(a.objectData),b}),e.info("Saving your precious animation..."),D.each(D.chunk(b,c.framesPageSize),function(a){h=l.post("edit/frames",a),y.setDirty(a,!1),j.push(h),h.then(D.noop,function(){y.setDirty(a,!0)})}),A>0&&(h=l.customDELETE("edit/frames",{fromOrder:y.framesCount,count:A}),A=0,h.then(D.noop,function(){A=k}),j.push(h)),j=f.all(j),j.then(function(){e.success("Great! Your animation was successfully saved")}),j)}function m(){var b;if(y.framesCount){if(y.framesCount===c.framesLimit)return void e.info("WOW! You have made longest animation we can save! It's time to publish!");y.framesCount/c.framesLimit===.8&&e.warning("You're getting close to our limits! Animations can have up to "+c.framesLimit+" frames",{timeout:7e3}),b=y.cloneFrame(y.frames[y.framesCount-1]),b.order=y.framesCount,y.currentFrameIndex=b.order}else b={animation:a.animId,order:0,
repeat:1},y.currentFrameIndex=b.order,y.currentFrame=b;b.dirty=!0,y.frames[b.order]=b,A--}function n(a){var b=D.keys(y.frames).length;if(0>a)if(y.currentFrameIndex>0)y.currentFrameIndex+=a;else{if(!y.repeat)return void q();y.currentFrameIndex=b-1}else if(y.currentFrameIndex<b-1)y.currentFrameIndex+=a;else{if(!y.repeat)return void q();y.currentFrameIndex=0}o()}function o(){y.playing&&j(D.partial(n,1),100*y.frames[y.currentFrameIndex].repeat)}function p(){return y.playing=!0,o(),B=f.defer(),B.promise}function q(){y.playing=!1,B.resolve()}function r(a){1!==y.framesCount&&(delete y.frames[a.order],a.layer.remove(),D.each(y.frames,function(b,c){c<=a.order||(y.frames[c-1]=b,b.order--,b.dirty=!0)}),delete y.frames[y.framesCount-1],y.frames[y.currentFrameIndex]?y.currentFrame=y.frames[y.currentFrameIndex]:y.currentFrameIndex--,A++)}function s(a){if(a){var b=y.cloneFrame(a);y.currentFrame.layer.removeChildren(),b.layer=y.currentFrame.layer,b.order=y.currentFrame.order,b.dirty=!0,y.frames[y.currentFrame.order]=y.currentFrame=b}}function t(){return D.filter(D.toArray(y.frames),{dirty:!0})}function u(a,b){a=D.isArray(a)?a:[a],D.each(a,function(a){y.frames[a.order].dirty=b})}function v(a){var b=D.clone(D.omit(a,"layer"));return b.repeat=1,b}function w(){return D.isEmpty(y.getDirty())&&0>=A}function x(){D.invoke(C,"call"),C=[],g.cancel(z)}var y,z,A,B,C=[],D=b;return y={frames:{},currentFrame:{},clipboardFrame:!1,framesCount:0,repeat:!0,playing:!1,init:k,save:l,next:n,play:p,stop:q,newFrame:m,pasteFrame:s,removeFrame:r,cloneFrame:v,getDirty:t,setDirty:u,isClean:w,destroy:x}}angular.module("canvas").factory("dpCanvasFrames",a),a.$inject=["$stateParams","$rootScope","AnimsConfig","dpResource","dpToast","$q","$interval","$state","dpObjectData","$timeout"]}(),function(){function a(a,b,c,d,e,f,g,h,i){function j(){h.when(k()).then(function(a){F=I.mapValues(a.data,function(a){return f.unpack(a)}),I.each(I.keys(F).reverse(),function(a){o(a)}),d.$broadcast("actionsReady")}),e.get("/api/anims/config/figures").success(function(a){g.canvas.figures=a})}function k(){return I.isEmpty(i.recentlyUsedFigures)?e.get("modules/canvas/canvas/predefined-objects.json").success(function(a){i.recentlyUsedFigures=a}):{data:i.recentlyUsedFigures}}function l(a){return{name:a,type:"Recently Used Figures",text:"Add new",execute:p}}function m(){i.recentlyUsedFigures={},I.each(I.filter(D.actions,{type:"Recently Used Figures"}),function(a){i.recentlyUsedFigures[a.name]=f.pack(F[a.name])})}function n(){var a=I.findLast(D.actions,{type:"Recently Used Figures"});I.remove(D.actions,{name:a.name})}function o(a){return I.any(D.actions,{name:a})?void 0:(D.actions.unshift(l(a)),!0)}function p(a){var b,c=I.isString(a)?[a]:a.source;q(c).then(function(){I.each(c,function(a){b=H.importObject(F[a],!0),s(b),o(a)&&(n(),m())})})}function q(a){var b,c,d,i=[];return I.each(a,function(a){F[a]?(b=h.defer(),b.resolve(),i.push(b.promise)):(D.loading=!0,c=e.get(g.canvas.figuresPath+a+".jsonpack"),c.success(function(b){F[a]=f.unpack(b)}),i.push(c))}),d=h.all(i),d.then(function(){D.loading=!1}),d}function r(a,b){var c;c=a(b),H.objects.addChild(c),c.position=G.view.center,H.createHandles(c),s(c)}function s(a){a.data={refId:a.id,handleRadius:J.handleRadius},a.selected=H.showAllPaths,H.createScales(a),H.selectObject(a),H.selectPath(a.firstChild),H.draw()}function t(a){I.extend(a.data,{movable:!0,refId:a.id}),a.style=K}function u(){var a=new G.Path(new G.Point(0,0));return t(a),a.data.movableRoot=!0,new G.Group(a)}function v(a,b,c){var d,e,f;switch(c=c||{},f=c.absolute?b:a.add(b),c.type){case"circle":b=new G.Point(b),e=a.add(b.divide(2)),d=new G.Path.Circle({center:e,radius:b.length/2}),d.rotate(-90),c.rotate&&d.rotate(c.rotate,a);break;default:d=new G.Path(a,f)}return t(d),new G.Group(d)}function w(){var a=u();return a.addChild(v(a.firstChild.lastSegment.point,[100,0])),a}function x(){var a=u();return a.addChild(v(a.firstChild.firstSegment.point,[0,-100],{type:"circle"})),a}function y(a){var b,c=u(),d=new G.PointText([0,0]);return d.fontSize=30,d.content=a.source,b=v(d.bounds.bottomLeft,d.bounds.bottomRight,{absolute:!0}),c.firstChild.firstSegment.point=d.bounds.bottomLeft,b.firstChild.visible=!1,b.addChild(d),c.addChild(b),c}function z(a){var b,c=u();return c.importSVG(a.source),b=v(c.bounds.bottomLeft,c.bounds.bottomRight,{absolute:!0}),c.firstChild.firstSegment.point=c.bounds.bottomLeft,b.firstChild.visible=!1,b.addChild(c.children[1]),c.addChild(b),c}function A(a){var b,c,d,e=[],f=u();b=new DataView(a.source),c=b.getUint8(1);for(var g=0;c>g;g++)d=24*g+2,e.push({parent:b.getUint8(d),id:b.getUint8(d+1),length:b.getFloat32(d+4,!0),angle:b.getFloat64(d+8,!0)*(180/Math.PI),strokeWidth:b.getFloat32(d+16,!0),isCircle:b.getUint8(d+20),isStatic:b.getUint8(d+21)});return e=I.sortBy(e,"parent"),I.each(e,function(a){f.dpGetStkPathById(a.id)||(0===a.parent?f.addChild(C(f.firstChild.lastSegment.point,a)):B(a,e,f))}),f}function B(a,b,c){var d,e=c.dpGetStkPathById(a.parent);return e||(e=B(I.find(b,{id:a.parent}),b,c)),d=C(e.dpGetOppositeSegment().point,a),e.parent.addChild(d),d.firstChild}function C(a,b){var c,d,e=new G.Point({length:b.length,angle:b.angle});return b.isCircle?(d=a.add(e.divide(2)),c=new G.Path.Circle({center:d,radius:b.length/2}),c.rotate(b.angle)):(e=e.add(a),c=new G.Path(a,e)),t(c),c.strokeWidth=b.strokeWidth,c.data.stkId=b.id,b.isStatic?c.data.handleRadius=0:b.strokeWidth<=4?c.data.handleRadius=4:5===b.strokeWidth?c.data.handleRadius=5:c.data.handleRadius=J.handleRadius,new G.Group(c)}var D,E,F={},G=a,H=b,I=d,J=c,K={strokeWidth:12,fillColor:"#FFF",strokeColor:"#000",strokeCap:"round"};return E=[{name:"Stickfigure",type:"Insert",text:"Choose Stickfigure",execute:p},{name:"Picture",type:"Insert",text:"Choose Picture",icon:"photo",execute:I.wrap(z,r)},{name:"Text",type:"Insert",text:"Write Text",icon:"text-format",execute:I.wrap(y,r)},{name:"Line",type:"Draw",text:"Add new",icon:"add",execute:I.wrap(w,r)},{name:"Circle",type:"Draw",text:"Add new",icon:"add",execute:I.wrap(x,r)},{name:"Import SVG",type:"Import",format:"svg",execute:I.wrap(z,r)},{name:"Import STK",type:"Import",format:"stk",execute:I.wrap(A,r)}],D={actions:E,loading:!1},j(),D}angular.module("canvas").factory("dpCanvasObjects",a),a.$inject=["dpPaperScope","dpCanvas","dpCanvasConfig","$rootScope","$http","dpObjectData","AnimsConfig","$q","$localStorage"]}(),function(){function a(a,b,c){function d(){f.Item.inject({dpGetRootObjectOfJoinedGroup:function(){return this.parent.dpIsObjectsRoot()?this:this.parent.dpGetRootObjectOfJoinedGroup()},dpIs:function(a){return g.any(this.parent.children,function(b){return b.getClassName()===a})},dpScale:function(a,b,c,d){var e=a,f=a;c||(f="x"===b?1:f,e="y"===b?1:e),this.scale(e,f,d),this.dpScaleStrokeWidth&&this.dpScaleStrokeWidth(a)},dpSetScaleParams:function(){this.data.scale&&g.isFinite(this.data.scale.x)&&g.isFinite(this.data.scale.y)||(this.data.scale={x:100,y:100})}}),f.Path.inject({dpGetOppositeSegment:function(){return 4===this.segments.length?this.segments[2]:this.lastSegment},dpGetObject:function(){return this.data.movableRoot?this.parent:this.parent.parent.firstChild.dpGetObject()},dpSetState:function(a,c,d){return a===h.HIDE||c&&this.data.mainHandle?void(this.visible=!1):(this.visible=!0,this.dpSetRadius(a===h.JOIN||d?b.handleRadius:this.data.radius),a=this.data.joins?h.JOIN:a,void(this.fillColor=i[a][this.data.mainHandle?0:1]))},dpGetGroupSiblings:function(){return g.rest(this.parent.children)},dpIsCircle:function(){return 4===this.segments.length},dpGetJoinedSiblings:function(){return g.filter(this.dpGetGroupSiblings(),function(a){return a.firstChild&&a.firstChild.data.movableRoot})},dpSetRadius:function(a,b){var c=this.bounds.width/2;return a?(this.scale(a/c,b),void(this.visible=!0)):void(this.visible=!1)}}),f.Group.inject({dpGetObjects:function(){var a=this.getItems({data:{movableRoot:!0}});return g.pluck(a,"parent")},dpGetMovablePaths:function(){return this.getItems({data:{movable:!0}})},dpGetOverlapping:function(a){return this.getItems({overlapping:a,data:{mainHandle:!0}})},dpGetTextItem:function(){return this.getItem({"class":f.PointText})},dpIsObjectsRoot:function(){return"objectsRoot"===this.name},dpGetObjectsRoot:function(){var a=this.getItem({name:"objectsRoot"});return a||(a=new f.Group,a.name="objectsRoot",this.addChild(a)),a},dpGetHandlesRoot:function(){return this.getItem({name:"handlesRoot"})},dpGetReferencePath:function(a){return a?this.getItem({data:{refId:a.data.refId}}):void 0},dpChangeOrder:function(a){this.dpIsObjectsRoot()||(this.data.movableRoot||(this.parent.dpIsObjectsRoot()||"bringToFront"===a?this[a]():this.moveAbove(this.parent.firstChild)),this.parent.dpChangeOrder(a))},dpScaleStrokeWidth:function(a){g.each(this.dpGetMovablePaths(),function(b){b.strokeWidth*=a})},dpReduce:function(){var a=this;g.each(g.clone(this.children),function(b){a.parent.addChild(b)}),a.remove()},dpGetReferenceable:function(){return this.getItems({data:function(a){return g.isNumber(a.refId)}})},dpUpdateReferences:function(){this.data.refId=this.id,g.each(this.dpGetReferenceable(),function(a){a.data.refId=a.id})},dpGetStkPathById:function(a){return this.getItem({data:function(b){return b.stkId===a}})}}),f.Layer.inject({dpGetExportableGroup:function(){var a=this.getItem({name:"exportable"});return a||(a=new f.Group,a.name="exportable"),a},dpGetReferenceObjects:function(a){var b=this;return a=g.isArray(a)?a:[a],g.compact(g.map(a,function(a){return b.getItem({data:{refId:a.data.refId}})}))}})}var e,f=c,g=a,h=b.handleState,i=b.handleColor;return e={init:d}}angular.module("canvas").factory("dpCanvasPaper",a),a.$inject=["$rootScope","dpCanvasConfig","dpPaperScope"]}(),function(){function a(a,b,c,d,e){function f(){o=new x.Tool,p.attachKeyEvents(),o.onMouseDown=i,o.onMouseDrag=j,o.onMouseUp=k}function g(){o.onKeyDown=l,o.onKeyUp=m}function h(){o.off("keydown"),o.off("keyup")}function i(){w.selected.handle||(r=new x.Path.Rectangle,v.extend(r,{selected:!0}),r.bringToFront(),w.mode=t.SELECT,w.refreshHandles(),q=[])}function j(a){if(r){var b,c,d,e,f,g,h;b=Math.min(a.point.x,a.downPoint.x),c=Math.min(a.point.y,a.downPoint.y),d=Math.abs(a.point.x-a.downPoint.x),e=Math.abs(a.point.y-a.downPoint.y),f=new x.Rectangle(b,c,d,e),r.segments=[f.topLeft,f.topRight,f.bottomRight,f.bottomLeft],w.setHandlesState(q,u.BLUR),q=[],h=w.handles.dpGetOverlapping(f);for(var i=0;i<h.length;i++)g=w.getPathByHandle(h[i]).dpGetRootObjectOfJoinedGroup(),q=q.concat(g.dpGetObjects());q=v.uniq(q,"id"),w.setHandlesState(q,u.SELECTED)}}function k(){w.selected.handle?(w.mode=t.SELECT,w.selected.handle=!1):(r&&(r.remove(),r=!1),v.isEmpty(q)||a.$apply(function(){w.selected.objects=v.uniq(w.selected.objects.concat(q),"id")})),w.applyActiveLayer()}function l(b){var c,d,e=b.event.shiftKey,f=b.event.ctrlKey;switch(b.key){case"left":case"right":a.$apply(function(){y.next("left"===b.key?-1:1)});break;case"c":e?a.$apply(function(){y.clipboardFrame=y.currentFrame}):f?w.copySelected():w.cloneSelected();break;case"v":e?a.$apply(function(){y.pasteFrame(y.clipboardFrame)}):w.centerSelected();break;case"f":w.flipSelected();break;case"j":w.joinMode();break;case"g":w.changeSelectedOrder("bringToFront");break;case"h":w.changeSelectedOrder("sendToBack");break;case"delete":w.removeSelected();break;case"p":case"o":w.selected.objects.length&&(c="o"===b.key?"x":"y",w.selected.objects[0].data.scale[c]+=e?-1:1,w.setSelectedScale(w.selected.objects[0].data.scale[c],c));break;case"i":w.selected.objects.length&&(d=e?-1:1,w.setSelectedStrokeWidth(w.selected.objects[0].strokeWidth+d));break;case"y":case"u":w.isPathSettingVisible("scale")&&(c="y"===b.key?"x":"y",w.selected.path.data.scale[c]+=e?-1:1,w.setSelectedPathScale(w.selected.path.data.scale[c],c));break;case"t":w.isPathSettingVisible("strokeWidth")&&(d=e?-1:1,w.selected.path.strokeWidth+=d);break;case"space":b.event.preventDefault(),w.selected.handle&&w.selected.handle.emit("mouseup"),q=[],o.emit("mouseup"),a.$apply(function(){y.newFrame()});break;case"x":e&&w.pasteSelected();break;case"z":e&&w.copySelected();break;case"b":e&&a.$apply(function(){y.pasteFrame(y.frames[y.currentFrameIndex-1])});break;case"w":a.$apply(function(){w.onionLayers.enabled=!w.onionLayers.enabled});break;case"e":a.$apply(function(){w.showHandles=!w.showHandles});break;case"r":a.$apply(function(){w.showAllPaths=!w.showAllPaths});break;case"a":w.initPlaying();break;case"m":s||(w.refreshHandles(!0),s=!0)}}function m(a){switch(a.key){case"m":w.refreshHandles(),s=!1}}function n(){o.remove()}var o,p,q,r,s,t=d.mode,u=d.handleState,v=a,w=c,x=b,y=e;return p={init:f,attachKeyEvents:g,detachKeyEvents:h,destroy:n}}angular.module("canvas").factory("dpCanvasTool",a),a.$inject=["$rootScope","dpPaperScope","dpCanvas","dpCanvasConfig","dpCanvasFrames"]}(),function(){function a(a){function b(){a.$parent.title="About Us"}var c=this;c.activate=b,b()}angular.module("core").controller("AboutController",a),a.$inject=["$scope"]}(),function(){function a(a){a.html5Mode(!0)}function b(a){a.setBaseUrl("/api").setRestangularFields({id:"_id"}).setResponseExtractor(function(a,b){var c=a||{};return"getList"!==b||angular.isArray(a)?c.origEl=angular.copy(a):(c=a.list,c.meta=a.meta,angular.forEach(c,function(a,b){c[b].origEl=angular.copy(a)})),c})}function c(a){a.configure({verticalPosition:"top",horizontalPosition:"right",maxNumber:3,timeout:5e3})}function d(a){a.theme("default").primaryPalette("green").accentPalette("amber").warnPalette("pink")}function e(a){a.options({appendToBody:!0})}function f(a,b,c,d){a.setErrorInterceptor(function(a){switch(a.status){case 403:b.danger("Sorry, you're to do it, please sign in with different account"),c.go("userForm.signin");break;case 401:b.danger("Please sign in first!"),c.go("userForm.signin");break;case 400:b.danger(a.data&&a.data.message);break;default:b.danger()}d.eventTrack("error-response-"+a.status,{category:a.config.url,label:a.data&&a.data.message})})}function g(a){a.decorator("$exceptionHandler",h)}function h(a,b,c){return function(d,e){k(b,d,c),a(d,e)}}function i(a,b,c){a.$on("$routeChangeError",function(a,d,e,f){var g=d&&(d.title||d.name||d.loadedTemplateUrl)||"unknown target",h="Sorry, I couldn't get to "+g+". "+(f.msg||"");b.danger(h),c.go("home")})}function j(a,b){a.init("150162395079841"),b.init()}var k=_.throttle(function(a,b,c){var d=c.user?c.user._id:"";a.eventTrack("error-js",{category:b.message,label:d+"\n"+location.pathname+"\n"+navigator.userAgent+"\n"+b.stack})},3e4);angular.module("core").config(a).config(b).config(c).config(d).config(g).config(e).run(i).run(f).run(j).constant("CloudinaryUrl","https://res.cloudinary.com/hrvldaxzr/image/upload/"),a.$inject=["$locationProvider"],b.$inject=["RestangularProvider"],c.$inject=["ngToastProvider"],d.$inject=["$mdThemingProvider"],e.$inject=["$tooltipProvider"],f.$inject=["Restangular","dpToast","$state","$analytics"],g.$inject=["$provide"],h.$inject=["$delegate","$analytics","Authentication"],i.$inject=["$rootScope","dpToast","$state"],j.$inject=["$FB","dpBrowseHistory"]}(),function(){angular.module("core").constant("jsonpack",jsonpack).constant("paper",paper)}(),function(){function a(a){var b=a,c={};c.chunk=function(a,c){return b.transform(a,function(a,b,d,e){return d%c===0?a.push(e.slice(d,d+c)):null})},c.stripBase64=function(a){return a.replace(/^data:image\/png;base64,/,"")},b.each(c,function(a,c){b[c]=b.bind(a,b)})}angular.module("core").run(a),a.$inject=["$rootScope"]}(),function(){function a(a,b){b.otherwise("/"),a.state("home",{url:"/",controller:"HomeController",controllerAs:"vm",templateUrl:"modules/core/home/home.client.view.html"}).state("userForm.contact",{url:"/contact",controller:"ContactController",controllerAs:"vm",templateUrl:"modules/core/contact/contact.client.view.html"}).state("userForm.about",{url:"/about",controller:"AboutController",controllerAs:"vm",templateUrl:"modules/core/about/about.client.view.html"})}angular.module("core").config(a),a.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){function a(a,b,c,d,e,f,g){function h(){a.$parent.title="Contact Us",j.contact.email=b.user?b.user.email:""}function i(){c.all("contact").post(j.contact).then(function(){e.success("Thank you for leaving a message! We'll take a look ASAP"),d.back(),g.eventTrack("contact",{category:j.contact.email,label:j.contact.subject})})}var j=this;j.sendContactMsg=i,j.contactConfig=f.contact,j.contact={},j.activate=h,h()}angular.module("core").controller("ContactController",a),a.$inject=["$scope","Authentication","Restangular","dpBrowseHistory","dpToast","UsersConfig","$analytics"]}(),function(){function a(a){function b(b,c,d,e){b.$watch(function(){return a(d.dpRepeatPassword)(b)===e.$modelValue},function(a){e.$setValidity("mismatch",a)})}var c={link:b,restrict:"A",require:"ngModel"};return c}angular.module("users").directive("dpRepeatPassword",a),a.$inject=["$parse"]}(),function(){function a(a){function b(a,b,d){var e=d.dpThumbType||"anims";d.$observe("dpThumbVersion",function(a,b){a!==b&&a&&c(d)}),d.$observe("dpThumb",function(a,b){a!==b&&a&&c(d)}),b.on("error",function(){d.$set("src","dist/thumbnails/"+e+"/"+e+"_tpl.png")})}function c(b){var c=a;b.dpThumbVersion&&(c=a+"v"+b.dpThumbVersion+"/"),b.$set("src",c+b.dpThumb+".png")}return{link:b,restrict:"A"}}angular.module("core").directive("dpThumb",a),a.$inject=["CloudinaryUrl"]}(),function(){function a(){function a(a,b,c){var d=[8,9,37,39,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105,110];b.bind("keydown",function(b){~d.indexOf(b.which)||(a.$apply(function(){a.$eval(c.dpValidNumber),b.preventDefault()}),b.preventDefault())})}var b={link:a,restrict:"A"};return b}angular.module("core").directive("dpValidNumber",a),a.$inject=[]}(),function(){function a(){return function(a,b,c){if(isNaN(b))return a;if(0>=b)return"";if(a&&a.length>b){if(a=a.substring(0,b),c)for(;" "===a.charAt(a.length-1);)a=a.substr(0,a.length-1);else{var d=a.lastIndexOf(" ");-1!==d&&(a=a.substr(0,d))}return a+"..."}return a}}angular.module("core").filter("characters",a),a.$inject=[]}(),function(){function a(){return function(a,b){if(isNaN(b))return a;if(0>=b)return"";if(a){var c=a.split(/\s+/);c.length>b&&(a=c.slice(0,b).join(" ")+"...")}return a}}angular.module("core").filter("words",a),a.$inject=[]}(),function(){function a(a,b){function c(c,d){var f=e.sections[c];f.types[d].list=a.all("list/"+c+"/"+d).getList({page:1,limit:f.limit}).then(function(a){f.types[d].list=a,b.add(a,c)})}function d(a,b){return a<b.length/2?"top":"bottom"}var e=this;e.sections={anims:{limit:8,types:{likes:{title:"Most Liked Animations"},recent:{title:"Recent Animations"},random:{title:"Random Animations"}}},users:{limit:6,types:{likes:{title:"Best Animators"}}}},e.getList=c,e.getPopoverPlacement=d}angular.module("core").controller("HomeController",a),a.$inject=["Restangular","dpResource"]}(),function(){function a(a,b,c){function d(){b.clear()}function e(){c("rightSidenav").toggle()}var f=this;f.auth=a,f.logout=d,f.openSidenav=e}angular.module("users").controller("HeaderController",a),a.$inject=["Authentication","dpResource","$mdSidenav"]}(),function(){function a(a,b,c){function d(){a.$on("$stateChangeSuccess",e)}function e(){c("rightSidenav").close()}var f=this;f.auth=b,f.closeSidenav=e,f.activate=d,d()}angular.module("users").controller("SidenavController",a),a.$inject=["$scope","Authentication","$mdSidenav"]}(),function(){function a(a,b){function c(){e=[],b.$on("$stateChangeStart",function(a,b,c,d,f){d.name&&!~d.name.indexOf("userForm.")&&e.push({state:d,params:f})})}function d(){var b=e.pop();b?a.go(b.state,b.params):a.go("home")}var e=[],f={init:c,back:d};return f}angular.module("core").factory("dpBrowseHistory",a),a.$inject=["$state","$rootScope"]}(),function(){function a(a){function b(){var b=a.navigator.userAgent;for(var d in c)if(c[d].test(b))return d;return"unknown"}var c={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/internet explorer/i},d={getType:b};return d}angular.module("core").factory("dpBrowserType",a),a.$inject=["$window"]}(),function(){function a(a,b){function c(b,c){a.create(h.extend({content:b,"class":"info"},c))}function d(b,c){a.create(h.extend({content:b,"class":"success"},c))}function e(b,c){a.create(h.extend({content:b,"class":"warning"},c))}function f(b,c){b=h.isString(b)?b:"",a.create(h.extend({content:b||i[h.random(i.length-1)],"class":"danger"},c))}var g,h=b,i=["Oops! Something went horribly wrong!","Oh no! I terribly failed!","Sorry, something just broke in me :(","Sorry, I must have bad day ..."];return g={info:c,success:d,warnign:e,danger:f}}angular.module("core").factory("dpToast",a),a.$inject=["ngToast","$rootScope"]}(),function(){function a(a,c,d,e,f,g,h,i,j,k,l,m){function n(){k.hash("top"),l(),v.current={user:e.get(c.userId,"users").$object},v.updateSortOpts(),v.initGetList()}function o(){v.loading=!0,h.all("list/anims/user/"+c.userId).getList({page:v.page,limit:g.userAnimsPageSize,sort:v.storage.sort,editable:v.storage.published?0:1}).then(function(a){v.loading=!1,v.allLoaded=a.length<g.userAnimsPageSize,v.anims=v.anims.concat(a),v.totalCount=a.meta.totalCount,e.set(v.anims)})}function p(){v.updateSortOpts(),v.initGetList()}function q(){v.creator&&(v.storage.published?v.sortOpts=w.clone(x):(v.storage.sort=v.sortOpts[1].value,v.sortOpts.shift()))}function r(){v.anims=[],v.page=1,v.getList()}function s(){v.page++,v.getList()}function t(a,c){i.show({controller:b,controllerAs:"vm",templateUrl:"modules/users/animations/delete-anim.client.view.html",targetEvent:c,hasBackdrop:!1}).then(function(){var b=w.findIndex(v.anims,{_id:a._id});v.anims.splice(b,1),v.totalCount--,h.restangularizeElement(null,a,"anims").remove().then(function(){m.eventTrack("anim-delete",{category:v.auth.user._id,label:a._id})},function(){v.anims.splice(b,0,a),v.totalCount++})})}function u(){h.all("anims").customPUT().then(function(a){m.eventTrack("anim-create",{category:v.auth.user._id,label:a._id}),j.go("canvas",{animId:a._id})})}var v=this,w=a,x=[{name:"Most popular",value:"-likesCount"},{name:"Newest first",value:"-datePublish"}];v.activate=n,v.getList=o,v.publishedSwitchChange=p,v.updateSortOpts=q,v.initGetList=r,v.showMore=s,v.removeAnim=t,v.createAnim=u,v.auth=d,v.creator=d.user&&d.user._id===c.userId,v.sortOpts=w.clone(x),v.storage=f.$default({userAnims:{sort:v.sortOpts[0].value,published:!1}}).userAnims,n()}function b(a){var b=this;b.mdDialog=a}angular.module("users").controller("AnimsUserController",a),a.$inject=["$scope","$stateParams","Authentication","dpResource","$localStorage","AnimsConfig","Restangular","$mdDialog","$state","$location","$anchorScroll","$analytics"],b.$inject=["$mdDialog"]}(),function(){function a(a,b,c,d,e,f,g){function h(){j.auth.user&&d.go("viewUser",{userId:j.auth.user._id}),a.$parent.title="Join us using your social accounts"}function i(a){b.all("auth/sign"+a).post(j.credentials).then(function(c){g.eventTrack("sign"+a,{category:c._id}),j.auth.user=b.restangularizeElement(null,c,"users"),e.clear(),f.back()})}var j=this;j.activate=h,j.auth=c,j.sign=i,h()}angular.module("users").controller("AuthenticationController",a),a.$inject=["$scope","Restangular","Authentication","$state","dpResource","dpBrowseHistory","$analytics"]}(),function(){function a(a,b,c,d,e,f){function g(){c.user&&d.go("/"),a.$parent.title="Restore password"}function h(){b.all("auth/forgot").post({email:i.email}).then(function(){e.success("Your password was reset. Please check your email"),d.go("home"),f.eventTrack("user-pass-forgot",{category:i.email})})}var i=this;i.activate=g,i.askForPasswordReset=h,g()}angular.module("users").controller("ForgotPasswordController",a),a.$inject=["$scope","Restangular","Authentication","$state","dpToast","$analytics"]}(),function(){function a(a,b,c,d,e,f,g){function h(){d.user&&e.go("home"),a.$parent.title="Reset your password"}function i(){c.all("auth/reset/"+b.token).post({newPass:j.newPass}).then(function(){f.success("Your password has been successfully updated, you can now sign in"),e.go("userForm.signin"),g.eventTrack("user-pass-reset",{category:b.token})})}var j=this;j.activate=h,j.resetUserPassword=i,h()}angular.module("users").controller("ResetPasswordController",a),a.$inject=["$scope","$stateParams","Restangular","Authentication","$state","dpToast","$analytics"]}(),function(){function a(a,b){b.user=a.restangularizeElement(null,b.user,"users")}angular.module("users").run(a),a.$inject=["Restangular","Authentication"]}(),function(){function a(a){a.state("userForm",{"abstract":!0,templateUrl:"modules/users/layout/form-user.client.view.html"}).state("userForm.profile",{url:"/settings/profile",controller:"EditProfileController",controllerAs:"vm",templateUrl:"modules/users/profile/edit-profile.client.view.html"}).state("userForm.password",{url:"/settings/password",controller:"ChangePasswordController",controllerAs:"vm",templateUrl:"modules/users/profile/change-password.client.view.html"}).state("userForm.signup",{url:"/signup",controller:"AuthenticationController",controllerAs:"vm",templateUrl:"modules/users/authentication/signup.client.view.html"}).state("userForm.signin",{url:"/signin",controller:"AuthenticationController",controllerAs:"vm",templateUrl:"modules/users/authentication/signin.client.view.html"}).state("userForm.forgot",{url:"/password/forgot",controller:"ForgotPasswordController",controllerAs:"vm",templateUrl:"modules/users/authentication/password/forgot-password.client.view.html"}).state("userForm.reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/authentication/password/reset-password-invalid.client.view.html"}).state("userForm.reset",{url:"/password/reset/:token",controller:"ResetPasswordController",controllerAs:"vm",templateUrl:"modules/users/authentication/password/reset-password.client.view.html"}).state("viewUser",{url:"/users/:userId",controller:"AnimsUserController",controllerAs:"vm",templateUrl:"modules/users/animations/anims-user.client.view.html"}).state("portrait",{url:"/users/:userId/portrait",controller:"PortraitController",controllerAs:"vm",templateUrl:"modules/users/portrait/portrait-user.client.view.html"})}angular.module("users").config(a),a.$inject=["$stateProvider"]}(),function(){function a(a,b){function c(a,c){d.paperScope.setup(c[0]),b.$broadcast("projectReady")}var d=a,e={link:c,restrict:"A"};return e}angular.module("users").directive("dpPortrait",a),a.$inject=["dpPaperScope","$rootScope"]}(),function(){function a(){function a(a,c,d){d.$observe("dpUserHref",function(a){a&&d.$set("href",b+d.dpUserHref)})}var b="users/",c={link:a,restrict:"A"};return c}angular.module("users").directive("dpUserHref",a),a.$inject=[]}(),function(){function a(a,b,c,d,e,f,g,h){function i(){o.auth.user&&b.userId===o.auth.user._id||d.go("userForm.signin"),a.$on("projectReady",function(){o.reset(!0),o.load(),o.t.init()})}function j(a){p.project.activeLayer.removeChildren(),o.background=p.project.activeLayer.dpGetBackground(p.project.view.bounds),o.background.strokeColor="black",o.template=new p.Raster({source:r,position:p.view.center}),o.template.visible=!a,o.template.bringToFront(),o.drawing=new p.Group,o.drawing.name="drawing",o.drawing.bringToFront(),o.t.initCursor()}function k(){var a=new Image;a.src=r,a.complete?o.addExistingPortrait(a.src):(a.onload=q.partial(o.addExistingPortrait,a.src),a.onerror=function(){o.template.visible=!0,p.view.draw()})}function l(){o.drawing.removeChildren(),o.template.remove(),p.view.draw()}function m(a){var b=new p.Raster({source:a,position:p.view.center});o.drawing.addChild(b),b.sendToBack()}function n(){var a=p.project.activeLayer.dpGetDataURL(p.view.bounds);o.auth.user.post("portrait",{portrait:q.stripBase64(a)}).then(function(a){c.user.thumbVersion=a.version,g.success("You're looking good! Your new portrait was successfully saved"),d.go("viewUser",{userId:b.userId}),h.eventTrack("user-portrait",{category:o.auth.user._id})})}var o=this,p=e,q=a,r="dist/thumbnails/users/users_tpl.png";o.auth=c,o.t=f,o.p=p,o.activate=i,o.reset=j,o.load=k,o.clear=l,o.save=n,o.addExistingPortrait=m,i()}angular.module("users").controller("PortraitController",a),a.$inject=["$scope","$stateParams","Authentication","$state","dpPaperScope","dpPortraitTool","dpToast","$analytics"]}(),function(){function a(a,b,c,d,e){function f(){c.user||b.go("userForm.signin"),a.$parent.title="Change password"}function g(){h.user.post("password",h.passwordDetails).then(function(){d.success("Your password was successfully changed"),b.go("viewUser",{userId:h.user._id}),e.eventTrack("user-pass-change",{category:h.user._id})})}var h=this;h.user=c.user,h.activate=f,h.changePassword=g,f()}angular.module("users").controller("ChangePasswordController",a),a.$inject=["$scope","$state","Authentication","dpToast","$analytics"]}(),function(){function a(a,b,c,d,e,f,g){function h(){c.user||b.go("userForm.signin"),a.$parent.title="Edit your profile"}function i(){j.user.save().then(function(){e.success("Your profile was successfully updated"),f.add(j.user,"users"),b.go("viewUser",{userId:j.user._id}),g.eventTrack("user-profile",{category:j.user._id})})}var j=this;j.user=c.user,j.UsersConfig=d,j.activate=h,j.saveProfile=i,h()}angular.module("users").controller("EditProfileController",a),a.$inject=["$scope","$state","Authentication","UsersConfig","dpToast","dpResource","$analytics"]}(),function(){function a(a,b){function c(){m=p.project.activeLayer,k=new p.Tool,k.onMouseDown=f,k.onMouseDrag=g,k.onMouseUp=h,k.onMouseMove=i,j.initCursor()}function d(){n=new p.Shape.Circle,n.strokeColor="#000",n.bringToFront()}function e(){n.visible=!1,p.view.draw()}function f(a){n.visible=!1,l=new p.Path({segments:[a.point,a.point.add(0,.1)],strokeWidth:j.strokeWidth,strokeColor:j.strokeColor,strokeCap:"round"}),m.getItem({name:"drawing"}).addChild(l)}function g(a){l.add(a.point)}function h(a){l.simplify(),n.position=a.point,n.visible=!0}function i(a){var b,c,d=o.clone(p.view.bounds);if(d.height-=1,!a.point.isInside(d))return void(n.visible=!1);if(n.visible=!0,n.position=a.point,n.radius=j.strokeWidth/2,b=m.hitTest(a.point),!b)return void(n.strokeColor="#000");switch(b.type){case"segment":case"stroke":c=b.item.strokeColor;break;case"fill":c=b.item.fillColor;break;case"pixel":c=b.color,c.alpha||(c=new p.Color(255,255,255))}n.strokeColor=new p.Color(Math.round(1-c.gray))}var j,k,l,m,n={},o=b,p=a;return j={init:c,initCursor:d,strokeColor:"#000",strokeWidth:10,mouseLeave:e}}angular.module("users").factory("dpPortraitTool",a),a.$inject=["dpPaperScope","$rootScope"]}();